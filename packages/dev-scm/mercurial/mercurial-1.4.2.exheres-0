# Copyright (c) 2007 Alexander Færøy <ahf@exherbo.org>
# Copyright (c) 2008, 2009, 2010 Ingmar Vanhassel <ingmar@exherbo.org>
# Distributed under the terms of the GNU General Public License v2

require bash-completion distutils

SUMMARY="A fast, lightweight, distributed source control management system"
HOMEPAGE="http://mercurial.selenic.com/"
DOWNLOADS="http://www.selenic.com/${PN}/release/${PNV}.tar.gz"

UPSTREAM_RELEASE_NOTES="
    http://mercurial.selenic.com/wiki/WhatsNew [[ lang = en ]]
    http://mercurial.selenic.com/wiki/UpgradeNotes [[
        lang = en
        description = [ Important notes on upgrading from previous versions ]
    ]]
    http://mercurial.selenic.com/wiki/HgkExtension [[
        lang = en
        description = [ Setting up Hgk ]
    ]]
"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="tk [[ description = [ Install hgk, a port to mercurial of git's gitk repository viewer ] ]]"

DEPENDENCIES="
    build+run:
        dev-lang/python:=[>=2.4]
        tk? (
            dev-lang/tcl[>=8.4]
            dev-lang/tk[>=8.4]
        )
"

REMOTE_IDS="pypi:${PN}"

src_test() {
    edo cd tests
    edo ${PYTHON} ./run-tests.py -j${EXJOBS:-1} --verbose
}

src_install() {
    distutils_src_install
    dobashcompletion contrib/bash_completion
    doman doc/hg*.?
    dodoc doc/{hg.1,hgignore.5,hgrc.5}.{html,txt} contrib/sample.hgrc

    if option tk ; then
        dobin contrib/hgk
    fi
}

