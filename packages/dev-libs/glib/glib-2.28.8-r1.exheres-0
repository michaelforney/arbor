# Copyright 2007 Bryan Ã˜stergaard <kloeri@exherbo.org>
# Copyright 2008 Saleem Abdulrasool <compnerd@compnerd.org>
# Distributed under the terms of the GNU General Public License v2

require bash-completion glib

SLOT="2"
PLATFORMS="~amd64 ~arm ~ia64 ~ppc64 ~x86"
MYOPTIONS="
    fam  [[ description = [ Enable FAM support for file system monitoring ] ]]
    gtk-doc
"

DEPENDENCIES="
    build:
        app-doc/gtk-doc-autotools
        sys-devel/gettext[>=0.11]
        gtk-doc? ( dev-doc/gtk-doc[>=1.15] )
    build+run:
        fam? ( app-admin/gamin )
    test:
        dev-python/dbus-python
        dev-util/desktop-file-utils
        dev-util/pkg-config[>=0.16]
        gnome-bindings/pygobject:2
        sys-apps/dbus[>=1.2.14] [[ note = [ Required for building GDBus tests ] ]]
        x11-misc/shared-mime-info
    recommendation:
        sys-apps/dbus[>=1.2.14] [[ note = [ Required for GDBus ] ]]
        dev-libs/glib-networking [[ description = [ Required for GNet ] ]]
        gnome-desktop/dconf [[ description = [ Required for GSettings ] ]]
    suggestion:
        gnome-desktop/gvfs  [[ description = [ Provides utilities and support for GIO ] ]]
"

# NOTE: glib:2 is used by sydbox, and thus in system. For this reason it shouldn't hard depend on
# anything not in ::arbor, that means no recommendations, just suggestions

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}"/glib-2.24.1-assert-test.patch )
# The internal copy of PCRE is old but "patched to use GLib for memory management and Unicode
# handling". Its usage is recommended by upstream, see also
# http://developer.gimp.org/api/2.0/glib/glib-building.html#Dependencies
DEFAULT_SRC_CONFIGURE_PARAMS=( '--enable-static' '--disable-selinux' '--disable-xattr'
                               '--with-pcre=internal' )
DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( fam gtk-doc )

src_install() {
    glib_src_install

    edo rm "${IMAGE}"/etc/bash_completion.d/{gdbus-bash-completion.sh,gsettings-bash-completion.sh}
    edo rmdir "${IMAGE}"/etc/{bash_completion.d,}

    dobashcompletion "${WORK}"/gio/gdbus-bash-completion.sh gdbus
    dobashcompletion "${WORK}"/gio/gsettings-bash-completion.sh gsettings
}

